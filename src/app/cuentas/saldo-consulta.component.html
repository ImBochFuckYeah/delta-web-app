<div class="container-fluid mt-4">
  <h2>Consulta y Búsqueda de Saldos</h2>

  <div class="row g-2 mb-3">
    <div class="col-md-3">
      <input class="form-control" type="number" placeholder="IdSaldoCuenta" [(ngModel)]="idSaldoCuenta">
    </div>
    <div class="col-md-2">
      <button class="btn btn-primary w-100" (click)="consultarPorIdSaldo()" [disabled]="loading">
        <span *ngIf="loading" class="spinner-border spinner-border-sm me-2"></span>Saldo por Id
      </button>
    </div>
    <div class="col-md-3">
      <input class="form-control" placeholder="NoCuenta" [(ngModel)]="noCuenta">
    </div>
    <div class="col-md-2">
      <button class="btn btn-primary w-100" (click)="consultarPorNoCuenta()" [disabled]="loading">Saldo por NoCuenta</button>
    </div>
    <div class="col-md-2"></div>
  </div>

  <div class="row g-2 mb-4">
    <div class="col-md-8">
      <input class="form-control" placeholder="Buscar por nombre/apellido/correo" [(ngModel)]="buscarCliente" (keyup.enter)="buscarPorCliente()">
    </div>
    <div class="col-md-4">
      <button class="btn btn-outline-primary w-100" (click)="buscarPorCliente()">Buscar cuentas por cliente</button>
    </div>
  </div>

  <div *ngIf="saldo" class="card mb-4">
    <div class="card-body">
      <h5 class="card-title mb-3">Saldo</h5>
      <div class="row">
        <div class="col-md-3"><strong>Saldo anterior:</strong> {{saldo.SaldoAnterior | number:'1.2-2'}}</div>
        <div class="col-md-3"><strong>Débitos:</strong> {{saldo.Debitos | number:'1.2-2'}}</div>
        <div class="col-md-3"><strong>Créditos:</strong> {{saldo.Creditos | number:'1.2-2'}}</div>
        <div class="col-md-3"><strong>Saldo actual:</strong> <span class="text-primary">{{saldo.SaldoActual | number:'1.2-2'}}</span></div>
      </div>
    </div>
  </div>

  <div *ngIf="movs?.length">
    <h5>Movimientos</h5>
    <div class="table-responsive">
      <table class="table table-sm table-striped">
        <thead>
          <tr><th>Fecha</th><th>Tipo</th><th>Monto</th><th>Descripción</th></tr>
        </thead>
        <tbody>
          <tr *ngFor="let m of movs">
            <td>{{m.FechaMovimiento || m.Fecha | date:'yyyy-MM-dd HH:mm'}}</td>
            <td>{{m.TipoMovimiento}}</td>
            <td>{{m.Monto | number:'1.2-2'}}</td>
            <td>{{m.Descripcion}}</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <div *ngIf="cuentas?.length">
    <h5 class="mt-4">Cuentas encontradas</h5>
    <div class="table-responsive">
      <table class="table table-striped table-hover">
        <thead><tr><th>IdSaldoCuenta</th><th>Persona</th><th>Tipo</th><th>Estado</th><th>SaldoActual</th><th></th></tr></thead>
        <tbody>
          <tr *ngFor="let c of cuentas">
            <td>{{c.IdSaldoCuenta}}</td>
            <td>{{c.NombrePersona}}</td>
            <td>{{c.TipoSaldoCuenta}}</td>
            <td>{{c.EstadoCuenta}}</td>
            <td>{{c.SaldoActual | number:'1.2-2'}}</td>
            <td><button class="btn btn-sm btn-outline-secondary" (click)="idSaldoCuenta=c.IdSaldoCuenta; consultarPorIdSaldo()">Ver saldo</button></td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>
