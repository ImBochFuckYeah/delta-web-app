<div class="container mt-4">
  <h2>Gesti√≥n de Personas</h2>

  <div class="row mb-3">
    <div class="col-md-6">
      <div class="input-group">
        <input class="form-control" placeholder="Buscar por nombre, correo..."
               [(ngModel)]="searchTerm" (keyup.enter)="onSearch()">
        <button class="btn btn-primary" (click)="onSearch()" [disabled]="loading">
          <span *ngIf="loading" class="spinner-border spinner-border-sm me-2"></span>Buscar
        </button>
      </div>
    </div>
    <div class="col-md-6 text-end">
      <a class="btn btn-success" routerLink="/app/personas/crear"><i class="bi bi-plus-circle"></i> Nueva Persona</a>
    </div>
  </div>

  <div class="table-responsive">
    <table class="table table-striped table-hover">
      <thead>
      <tr>
        <th>ID</th><th>Nombre</th><th>Apellido</th><th>Correo</th><th>Tel√©fono</th><th>Acciones</th>
      </tr>
      </thead>
      <tbody>
      <tr *ngFor="let p of personas">
        <td>{{p.IdPersona}}</td>
        <td>{{p.Nombre}}</td>
        <td>{{p.Apellido}}</td>
        <td>{{p.CorreoElectronico}}</td>
        <td>{{p.Telefono}}</td>
        <td>
          <a class="btn btn-sm btn-primary me-2" [routerLink]="['/app/personas/editar', p.IdPersona]">Editar</a>
          <button class="btn btn-sm btn-danger" (click)="eliminar(p.IdPersona!)">Eliminar</button>
            <button class="btn btn-sm btn-outline-info" (click)="abrirDocumentos(p)">
    Ver Documentos
  </button>
        </td>
      </tr>
      <tr *ngIf="!loading && personas.length===0"><td colspan="6" class="text-center">Sin resultados</td></tr>
      </tbody>
    </table>
  </div>

  <nav *ngIf="totalPages>1">
    <ul class="pagination justify-content-center">
      <li class="page-item" [class.disabled]="page===1"><a class="page-link" (click)="onPageChange(page-1)">Anterior</a></li>
      <li class="page-item" *ngFor="let p of pages" [class.active]="p===page"><a class="page-link" (click)="onPageChange(p)">{{p}}</a></li>
      <li class="page-item" [class.disabled]="page===totalPages"><a class="page-link" (click)="onPageChange(page+1)">Siguiente</a></li>
    </ul>
  </nav>

</div>
<!-- =======================
  üü¢ Modal de Documentos
======================= -->
<div class="modal fade show d-block" *ngIf="mostrandoModal" style="background:rgba(0,0,0,0.5)">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header bg-primary text-white">
        <h5 class="modal-title">
          Documentos de {{ personaSeleccionada?.Nombre }} {{ personaSeleccionada?.Apellido }}
        </h5>
        <button type="button" class="btn-close" (click)="cerrarModal()"></button>
      </div>

      <div class="modal-body">
        <table class="table table-sm table-bordered">
          <thead>
            <tr>
              <th>Tipo de Documento</th>
              <th>N√∫mero</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let d of documentos">
              <td>{{ d.TipoDocumento }}</td>
              <td>{{ d.Numero }}</td>
            </tr>
            <tr *ngIf="!documentos.length">
              <td colspan="2" class="text-center text-muted">Sin documentos registrados</td>
            </tr>
          </tbody>
        </table>
      </div>

      <div class="modal-footer">
        <button class="btn btn-secondary" (click)="cerrarModal()">Cerrar</button>
      </div>
    </div>
  </div>
</div>
