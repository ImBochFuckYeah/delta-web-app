<div class="container-fluid mt-4">
  <div class="row justify-content-center">
    <div class="col-12 col-xl-11">
      
      <!-- Header -->
      <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
          <h2 class="mb-1">Gestión de Usuarios</h2>
          <p class="text-muted mb-0">Administra los usuarios del sistema</p>
        </div>
        <div *ngIf="isLoadingAny" class="d-flex align-items-center text-muted">
          <div class="spinner-border spinner-border-sm me-2" role="status" aria-label="Cargando"></div>
          <small>Cargando datos...</small>
        </div>
      </div>

      <!-- Buscador y acciones -->
      <div class="row mb-4">
        <div class="col-md-8 col-lg-6">
          <div class="input-group">
            <span class="input-group-text">
              <i class="fas fa-search"></i>
            </span>
            <input 
              type="text" 
              class="form-control" 
              placeholder="Buscar por nombre, email o ID..."
              [(ngModel)]="searchTerm" 
              (keyup.enter)="onSearch()"
              [disabled]="loading.usuarios"
              maxlength="100">
            <button 
              class="btn btn-outline-primary" 
              type="button"
              (click)="onSearch()" 
              [disabled]="loading.usuarios">
              <span *ngIf="loading.usuarios" class="spinner-border spinner-border-sm me-2" role="status"></span>
              Buscar
            </button>
          </div>
        </div>
        <div class="col-md-4 col-lg-6 text-end mt-3 mt-md-0">
          <button class="btn btn-success" routerLink="/app/usuarios/crear">
            <i class="fas fa-plus me-1"></i>
            <span class="d-none d-sm-inline">Nuevo Usuario</span>
          </button>
        </div>
      </div>

      <!-- Información de resultados -->
      <div class="row mb-3" *ngIf="hasResults && !loading.usuarios">
        <div class="col-12">
          <small class="text-muted">
            Mostrando {{ startItem }} a {{ endItem }} de {{ totalItems }} usuarios
          </small>
        </div>
      </div>

      <!-- Tabla de usuarios -->
      <div class="card shadow-sm">
        <div class="card-body p-0">
          <div class="table-responsive">
            <table class="table table-hover mb-0">
              <thead class="table-dark">
                <tr>
                  <th scope="col">ID Usuario</th>
                  <th scope="col">Nombre Completo</th>
                  <th scope="col">Email</th>
                  <th scope="col" class="d-none d-md-table-cell">Teléfono</th>
                  <th scope="col" class="d-none d-lg-table-cell">Sucursal</th>
                  <th scope="col">Estado</th>
                  <th scope="col" class="d-none d-xl-table-cell">Rol</th>
                  <th scope="col" class="text-center">Acciones</th>
                </tr>
              </thead>
              <tbody>
                <!-- Loading row -->
                <tr *ngIf="loading.usuarios">
                  <td colspan="8" class="text-center py-4">
                    <div class="d-flex justify-content-center align-items-center">
                      <div class="spinner-border text-primary me-3" role="status"></div>
                      <span class="text-muted">Cargando usuarios...</span>
                    </div>
                  </td>
                </tr>

                <!-- Data rows -->
                <tr *ngFor="let usuario of usuarios; trackBy: trackByUsuario" 
                    [class.table-warning]="usuario.IdStatusUsuario === 2"
                    [class.table-danger]="usuario.IdStatusUsuario === 3">
                  <td class="fw-bold">{{ usuario.IdUsuario }}</td>
                  <td>
                    <div class="d-flex flex-column">
                      <span class="fw-semibold">{{ usuario.Nombre }} {{ usuario.Apellido }}</span>
                      <small class="text-muted d-md-none">{{ usuario.CorreoElectronico }}</small>
                    </div>
                  </td>
                  <td class="d-none d-md-table-cell">
                    <a [href]="'mailto:' + usuario.CorreoElectronico" class="text-decoration-none">
                      {{ usuario.CorreoElectronico }}
                    </a>
                  </td>
                  <td class="d-none d-md-table-cell">
                    <span *ngIf="usuario.TelefonoMovil; else noPhone">
                      {{ usuario.TelefonoMovil }}
                    </span>
                    <ng-template #noPhone>
                      <span class="text-muted">-</span>
                    </ng-template>
                  </td>
                  <td class="d-none d-lg-table-cell">
                    <span class="badge bg-info text-dark">
                      {{ usuario.IdSucursal | sucursalName:sucursales }}
                    </span>
                  </td>
                  <td>
                    <span class="badge" 
                          [class.bg-success]="usuario.IdStatusUsuario === 1"
                          [class.bg-warning]="usuario.IdStatusUsuario === 2"
                          [class.bg-danger]="usuario.IdStatusUsuario === 3">
                      {{ usuario.IdStatusUsuario | statusName:statusUsuarios }}
                    </span>
                  </td>
                  <td class="d-none d-xl-table-cell">
                    <span class="badge bg-primary">
                      {{ usuario.IdRole | roleName:roles }}
                    </span>
                  </td>
                  <td class="text-center">
                    <div class="btn-group" role="group">
                      <button 
                        class="btn btn-sm btn-outline-primary"
                        [routerLink]="['/app/usuarios/editar', usuario.IdUsuario]"
                        title="Editar usuario">
                        <i class="fas fa-edit"></i>
                        <span class="d-none d-lg-inline ms-1">Editar</span>
                      </button>
                      <button 
                        class="btn btn-sm btn-outline-danger" 
                        (click)="eliminarUsuario(usuario.IdUsuario)"
                        title="Eliminar usuario">
                        <i class="fas fa-trash"></i>
                        <span class="d-none d-lg-inline ms-1">Eliminar</span>
                      </button>
                    </div>
                  </td>
                </tr>

                <!-- Empty state -->
                <tr *ngIf="!hasResults && !loading.usuarios">
                  <td colspan="8" class="text-center py-5">
                    <div class="d-flex flex-column align-items-center text-muted">
                      <i class="fas fa-users fa-3x mb-3 opacity-50"></i>
                      <h5>No se encontraron usuarios</h5>
                      <p class="mb-3">{{ searchTerm ? 'Intenta con otros términos de búsqueda' : 'No hay usuarios registrados aún' }}</p>
                      <button class="btn btn-primary" routerLink="/app/usuarios/crear">
                        <i class="fas fa-plus me-1"></i>
                        Crear primer usuario
                      </button>
                    </div>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Paginación -->
      <div class="row mt-4" *ngIf="totalPages > 1">
        <div class="col-12">
          <nav aria-label="Navegación de páginas">
            <ul class="pagination justify-content-center mb-0">
              <!-- Primera página -->
              <li class="page-item" [class.disabled]="currentPage === 1">
                <button 
                  class="page-link" 
                  (click)="onPageChange(1)"
                  [disabled]="currentPage === 1"
                  aria-label="Ir a la primera página">
                  <i class="fas fa-angle-double-left"></i>
                </button>
              </li>
              
              <!-- Página anterior -->
              <li class="page-item" [class.disabled]="currentPage === 1">
                <button 
                  class="page-link" 
                  (click)="onPageChange(currentPage - 1)"
                  [disabled]="currentPage === 1"
                  aria-label="Página anterior">
                  <i class="fas fa-angle-left"></i>
                </button>
              </li>
              
              <!-- Páginas numeradas -->
              <li class="page-item" 
                  *ngFor="let page of pages; trackBy: trackByPage" 
                  [class.active]="page === currentPage">
                <button 
                  class="page-link" 
                  (click)="onPageChange(page)"
                  [attr.aria-label]="'Ir a la página ' + page"
                  [attr.aria-current]="page === currentPage ? 'page' : null">
                  {{ page }}
                </button>
              </li>
              
              <!-- Página siguiente -->
              <li class="page-item" [class.disabled]="currentPage === totalPages">
                <button 
                  class="page-link" 
                  (click)="onPageChange(currentPage + 1)"
                  [disabled]="currentPage === totalPages"
                  aria-label="Página siguiente">
                  <i class="fas fa-angle-right"></i>
                </button>
              </li>
              
              <!-- Última página -->
              <li class="page-item" [class.disabled]="currentPage === totalPages">
                <button 
                  class="page-link" 
                  (click)="onPageChange(totalPages)"
                  [disabled]="currentPage === totalPages"
                  aria-label="Ir a la última página">
                  <i class="fas fa-angle-double-right"></i>
                </button>
              </li>
            </ul>
          </nav>
          
          <!-- Información de paginación -->
          <div class="text-center mt-2">
            <small class="text-muted">
              Página {{ currentPage }} de {{ totalPages }} 
              ({{ totalItems }} {{ totalItems === 1 ? 'usuario' : 'usuarios' }} en total)
            </small>
          </div>
        </div>
      </div>

    </div>
  </div>
</div>
