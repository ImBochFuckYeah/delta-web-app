<div class="container mt-4">
  <h2>Consulta de Saldos</h2>

  <!-- Mensaje de error -->
  <div *ngIf="error" class="alert alert-danger" role="alert">
    {{ error }}
  </div>

  <!-- Barra de búsqueda -->
  <div class="row mb-3">
    <div class="col-md-6">
      <div class="input-group">
        <input
          type="text"
          class="form-control"
          placeholder="Buscar por ID Cliente, ID Cuenta o Nombre del Cliente..."
          [(ngModel)]="searchTerm"
          (keyup.enter)="buscarSaldos()"
          [disabled]="loading">
        <button
          class="btn btn-primary"
          (click)="buscarSaldos()"
          [disabled]="loading">
          <span *ngIf="loading" class="spinner-border spinner-border-sm me-2"></span>
          Buscar
        </button>
        <button
          class="btn btn-secondary"
          (click)="limpiarBusqueda()"
          [disabled]="loading">
          Limpiar
        </button>
      </div>
    </div>
  </div>

  <!-- Tabla -->
  <div class="table-responsive">
    <table class="table table-striped table-hover">
      <thead>
        <tr>
          <th>ID Cuenta</th>
          <th>Cliente</th>
          <th>Tipo Cuenta</th>
          <th>Estado</th>
          <th class="text-end">Saldo Inicial</th>
          <th class="text-end">Cargos</th>
          <th class="text-end">Abonos</th>
          <th class="text-end">Saldo Final</th>
          <th>Fecha Creación</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let saldo of saldos">
          <td>{{ saldo.IdSaldoCuenta }}</td>
          <td>
            <div>{{ saldo.NombrePersona }}</div>
            <small class="text-muted">ID: {{ saldo.IdPersona }}</small>
          </td>
          <td>{{ saldo.TipoSaldoCuenta }}</td>
          <td>{{ saldo.EstadoCuenta }}</td>
          <td class="text-end">{{ formatoMoneda(saldo.SaldoAnterior) }}</td>
          <td class="text-end">{{ formatoMoneda(saldo.Debitos) }}</td>
          <td class="text-end">{{ formatoMoneda(saldo.Creditos) }}</td>
          <td class="text-end fw-bold">{{ formatoMoneda(saldo.SaldoActual) }}</td>
          <td>{{ formatoFecha(saldo.FechaCreacion) }}</td>
        </tr>
        <tr *ngIf="saldos.length === 0 && !loading">
          <td colspan="9" class="text-center">No se encontraron resultados</td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Paginación -->
  <nav *ngIf="totalPages > 1">
    <ul class="pagination justify-content-center">
      <li class="page-item" [class.disabled]="page === 1">
        <a class="page-link" (click)="onPageChange(page - 1)">Anterior</a>
      </li>
      <li
        class="page-item"
        *ngFor="let p of pages"
        [class.active]="p === page">
        <a class="page-link" (click)="onPageChange(p)">{{ p }}</a>
      </li>
      <li class="page-item" [class.disabled]="page === totalPages">
        <a class="page-link" (click)="onPageChange(page + 1)">Siguiente</a>
      </li>
    </ul>
  </nav>

  <!-- Loader -->
  <div *ngIf="loading" class="text-center mt-3">
    <div class="spinner-border text-primary">
      <span class="visually-hidden">Cargando...</span>
    </div>
  </div>
</div>
